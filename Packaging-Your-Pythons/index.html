<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Packaging Your Pythons</title><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="hovercraft.css" media="screen,projection"></link></head><body class="impress-not-supported"><div id="impress"><div class="step" step="0" data-x="0" data-y="0"><h1 id="packaging-your-pythons">Packaging Your Pythons</h1><p>A talk by <a href="https://twitter.com/dirn">@dirn</a></p></div><div class="step" step="1" data-x="1600" data-y="0"><h1 id="so-you-want-to-package-your-code">So you want to package your code</h1></div><div class="step" step="2" data-x="3200" data-y="0"><p>Where do you begin?</p></div><div class="step" step="3" data-x="4800" data-y="0"><p><tt>setup.py</tt></p></div><div class="step has-code" step="4" data-x="6400" data-y="0"><pre class="highlight code python"><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s">'nycpython'</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s">'1.0.0'</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s">'The official package of NYC Python'</span><span class="p">,</span>
    <span class="n">url</span><span class="o">=</span><span class="s">'https://github.com/NYCPython/nycpython'</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s">'Andy Dirnberger'</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s">'andy@nycpython.com'</span><span class="p">,</span>
    <span class="n">license</span><span class="o">=</span><span class="s">'BSD'</span><span class="p">,</span>
    <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s">'nycpython'</span><span class="p">],</span>
    <span class="n">zip_safe</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
<span class="p">)</span></pre></div><div class="step" step="5" data-x="8000" data-y="0" data-rotate-z="270"><p><em>An aside about versions</em></p></div><div class="step" step="6" data-x="9600" data-y="0" data-rotate-z="270"><p><a href="http://www.python.org/dev/peps/pep-0386/">PEP 386</a> (current)</p><p><a href="http://www.python.org/dev/peps/pep-0440/">PEP 440</a> (future)</p></div><div class="step" step="7" data-x="11200" data-y="0" data-rotate-z="0"><p>Package layout</p></div><div class="step has-code" step="8" data-x="12800" data-y="0"><pre class="highlight code sh"><span class="nv">$ </span>tree
.
|-- nycpython
|   |-- __init__.py
|-- setup.py</pre></div><div class="step" step="9" data-x="14400" data-y="0"><p><tt>nycpython/__init__.py</tt></p></div><div class="step has-code" step="10" data-x="16000" data-y="0"><pre class="highlight code python"><span class="sd">"""The magic of NYC Python"""</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s">'1.0.0'</span>


<span class="k">def</span> <span class="nf">make_the_awesome</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">'http://nycpython.com'</span></pre></div><div class="step has-code" step="11" data-x="17600" data-y="0"><pre class="highlight code sh"><span class="nv">$ </span>python</pre><pre class="highlight code python"><span class="kn">from</span> <span class="nn">nycpython</span> <span class="kn">import</span> <span class="n">make_the_awesome</span>
<span class="k">print</span><span class="p">(</span><span class="n">make_the_awesome</span><span class="p">)</span></pre></div><div class="step" step="12" data-x="19200" data-y="0" data-rotate-z="270"><p><em>An aside about modules</em></p></div><div class="step" step="13" data-x="20800" data-y="0" data-rotate-z="270"><p>instead of</p><p><tt>nycpython/__init__.py</tt></p><p>and</p><p><tt>packages=['nycpython']</tt></p></div><div class="step" step="14" data-x="22400" data-y="0" data-rotate-z="270"><p>we could have used</p><p><tt>nycpython.py</tt></p><p>and</p><p><tt>pymodules=['nycpython']</tt></p></div><div class="step" step="15" data-x="24000" data-y="0" data-rotate-z="270"><p><em>Why didn't we?</em></p></div><div class="step" step="16" data-x="25600" data-y="0" data-rotate-z="270"><p>Growth</p></div><div class="step" step="17" data-x="27200" data-y="0" data-rotate-z="0"><p>That was easy, right?</p></div><div class="step" step="18" data-x="28800" data-y="0"><p><strong>But this is open source night</strong></p><p>we can do better</p></div><div class="step" step="19" data-x="30400" data-y="0"><h1 id="readme">README</h1></div><div class="step" step="20" data-x="32000" data-y="0"><h1 id="license">LICENSE</h1></div><div class="step has-code" step="21" data-x="33600" data-y="0"><pre class="highlight code sh"><span class="nv">$ </span>tree
.
|-- LICENSE
|-- nycpython
|   |-- __init__.py
|-- README.rst
|-- setup.py</pre></div><div class="step has-code" step="22" data-x="35200" data-y="0"><pre class="highlight code python"><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="kn">from</span> <span class="nn">nycpython</span> <span class="kn">import</span> <span class="n">__version__</span>


<span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s">'nycpython'</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s">'The official package of NYC Python'</span><span class="p">,</span>
    <span class="n">long_description</span><span class="o">=</span><span class="n">read_file</span><span class="p">(</span><span class="s">'README.rst'</span><span class="p">),</span>
    <span class="n">url</span><span class="o">=</span><span class="s">'https://github.com/NYCPython/nycpython'</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s">'Andy Dirnberger'</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s">'andy@nycpython.com'</span><span class="p">,</span>
    <span class="n">license</span><span class="o">=</span><span class="n">read_file</span><span class="p">(</span><span class="s">'LICENSE'</span><span class="p">),</span>
    <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s">'nycpython'</span><span class="p">],</span>
    <span class="n">zip_safe</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">classifiers</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">],</span>
<span class="p">)</span></pre></div><div class="step" step="23" data-x="36800" data-y="0"><h1 id="learn-from-my-mistake">Learn from my mistake</h1></div><div class="step" step="24" data-x="38400" data-y="0"><p><tt>MANIFEST.in</tt></p></div><div class="step" step="25" data-x="40000" data-y="0"><p><tt>include LICENSE README.rst</tt></p><p>~ or ~</p><p><tt>include *.rst LICENSE</tt></p></div><div class="step has-code" step="26" data-x="41600" data-y="0"><pre class="highlight code sh"><span class="nv">$ </span>tree
.
|-- LICENSE
|-- MANIFEST.in
|-- nycpython
|   |-- __init__.py
|-- README.rst
|-- setup.py</pre></div><div class="step" step="27" data-x="43200" data-y="0" data-rotate-z="270"><p><em>An aside about reStructured Text</em></p></div><div class="step" step="28" data-x="44800" data-y="0" data-rotate-z="270"><p>Why not Markdown?</p></div><div class="step" step="29" data-x="46400" data-y="0" data-rotate-z="270"><p>PyPI <a class="footnoteref" id="footnote-backref-id1" href="#footnote-id2">*</a></p><div class="footnote" id="footnote-id2"><a class="footnotereturn" href="#footnote-backref-id1" title="return to content">*</a><p>more on that later</p></div></div><div class="step" step="30" data-x="48000" data-y="0" data-rotate-z="270"><p><a href="http://sphinx.rtfd.org">Sphinx</a></p></div><div class="step" step="31" data-x="49600" data-y="0" data-rotate-z="270"><p><a href="http://rtfd.org">Read the Docs</a></p></div><div class="step" step="32" data-x="51200" data-y="0" data-rotate-z="0"><h1 id="publishing-to-pypi">Publishing to PyPI</h1></div><div class="step" step="33" data-x="52800" data-y="0"><p>Now then, some cheese please, my good man.</p><p><em>Certainly, sir. What would you like?</em></p><p>Well, eh, how about a little red Leicester.</p><p><em>I'm, afraid we're fresh out of red Leicester, sir.</em></p></div><div class="step" step="34" data-x="54400" data-y="0"><p>Register on the <a href="https://pypi.python.org/pypi">Python Package Index</a></p></div><div class="step" step="35" data-x="56000" data-y="0"><p><strong>Not so fast!!</strong></p></div><div class="step" step="36" data-x="57600" data-y="0"><p>Register on the <a href="https://testpypi.python.org/pypi">test site</a></p></div><div class="step" step="37" data-x="59200" data-y="0"><p><tt>~/.pypirc</tt></p></div><div class="step has-code" step="38" data-x="60800" data-y="0"><pre class="highlight code ini"><span class="k">[distutils]</span>
<span class="na">index-servers</span> <span class="o">=</span><span class="s">
    pypi
    test</span>

<span class="k">[pypi]</span>
<span class="na">repository</span> <span class="o">=</span> <span class="s">http://pypi.python.org/pypi</span>
<span class="na">username</span> <span class="o">=</span> <span class="s">dirn</span>
<span class="na">password</span> <span class="o">=</span> <span class="s">&lt;my super secret password goes here&gt;</span>

<span class="k">[test]</span>
<span class="na">repository</span> <span class="o">=</span> <span class="s">https://testpypi.python.org/pypi</span>
<span class="na">username</span> <span class="o">=</span> <span class="s">dirn</span>
<span class="na">password</span> <span class="o">=</span> <span class="s">&lt;another super secret password goes here&gt;</span></pre></div><div class="step" step="39" data-x="62400" data-y="0"><h1 id="building-and-uploading">Building and Uploading</h1></div><div class="step" step="40" data-x="64000" data-y="0"><pre class="highlight code sh"><span class="nv">$ </span>python setup.py sdist</pre></div><div class="step" step="41" data-x="65600" data-y="0" data-rotate-z="270"><p><em>An aside about testing your build</em></p></div><div class="step has-code" step="42" data-x="67200" data-y="0" data-rotate-z="270"><pre class="highlight code sh"><span class="nv">$ </span>rm -rf build-env
<span class="nv">$ </span>virtualenv build-env
<span class="nv">$ </span>build-env/bin/pip install --no-index dist/nycpython-1.0.0.tar.gz
...
<span class="nv">$ </span>build-env/bin/python
&gt;&gt;&gt; import nycpython
&gt;&gt;&gt; nycpython.__version__
<span class="s1">'1.0.0'</span></pre></div><div class="step has-code" step="43" data-x="68800" data-y="0" data-rotate-z="0"><pre class="highlight code sh"><span class="nv">$ </span>python setup.py register -r <span class="nb">test</span>
<span class="nv">$ </span>python setup.py sdist upload -r <span class="nb">test</span></pre></div><div class="step has-code" step="44" data-x="70400" data-y="0"><pre class="highlight code sh"><span class="nv">$ </span>python setup.py register -r pypi
<span class="nv">$ </span>python setup.py sdist upload -r pypi</pre></div><div class="step" step="45" data-x="72000" data-y="0"><h1 id="installation">Installation</h1><pre class="highlight code sh"><span class="nv">$ </span>pip install nycpython</pre></div><div class="step" step="46" data-x="73600" data-y="0" data-rotate-z="270"><p><em>An aside about the future</em></p></div><div class="step" step="47" data-x="75200" data-y="0" data-rotate-z="270"><p><a href="http://wheel.rtfd.org">Wheel</a> <a class="footnoteref" id="footnote-backref-id3" href="#footnote-id4">&#x2020;</a></p><div class="footnote" id="footnote-id4"><a class="footnotereturn" href="#footnote-backref-id3" title="return to content">&#x2020;</a><p>Because 'newegg' was taken.</p></div></div><div class="step" step="48" data-x="76800" data-y="0" data-rotate-z="270"><p><tt>setup.cfg</tt></p></div><div class="step has-code" step="49" data-x="78400" data-y="0" data-rotate-z="270"><pre class="highlight code ini"><span class="k">[wheel]</span>
<span class="na">universal</span> <span class="o">=</span> <span class="s">1</span></pre></div><div class="step has-code" step="50" data-x="80000" data-y="0" data-rotate-z="270"><pre class="highlight code sh"><span class="nv">$ </span>pip install wheel
<span class="nv">$ </span>python setup.py bdist_wheel</pre></div><div class="step has-code" step="51" data-x="81600" data-y="0" data-rotate-z="270"><pre class="highlight code sh"><span class="nv">$ </span>rm -rf build-env
<span class="nv">$ </span>virtualenv build-env
<span class="nv">$ </span>build-env/bin/pip install --use-wheel --no-index <span class="se">\
</span>    --find-links dist nycpython
...
<span class="nv">$ </span>build-env/bin/python
&gt;&gt;&gt; import nycpython
&gt;&gt;&gt; nycpython.__version__
<span class="s1">'1.0.0'</span></pre></div><div class="step has-code" step="52" data-x="83200" data-y="0" data-rotate-z="270"><pre class="highlight code sh"><span class="nv">$ </span>python setup.py bdist_wheel upload -r <span class="nb">test</span></pre><p>and</p><pre class="highlight code sh"><span class="nv">$ </span>python setup.py bdist_wheel upload -r pypi</pre></div><div class="step" step="53" data-x="84800" data-y="0" data-rotate-z="0"><p><em>Questions?</em></p></div></div><div id="hovercraft-help" class="hide"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Left, Down, Page Down</th><td>Next slide</td></tr><tr><th>Right, Up, Page Up</th><td>Previous slide</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>